<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline';">
    <title>MTR Setup Assistant</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <img src="../../Bane_NOR_logo.svg.png" alt="Bane NOR Logo" class="logo">
                <h1>MTR Setup Assistant</h1>
                <button id="quitButton" class="quit-button">Quit</button>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab-btn active" data-tab="welcome">Welcome</button>
            <button class="tab-btn" data-tab="intune">Intune Provisioning</button>
            <button class="tab-btn" data-tab="account">Resource Account Management</button>
        </nav>

        <main>
            <!-- Welcome Tab -->
            <div class="tab-content active" id="welcome">
                <div class="welcome-section">
                    <h2>Welcome to MTR Setup Assistant</h2>
                    <p>Select one of the following options:</p>
                    <div class="steps">
                        <div class="step">
                            <h3>Intune Device Provisioning</h3>
                            <p>Register your Logitech MTR device with Microsoft Intune.</p>
                            <ul class="feature-list">
                                <li>Validate device serial numbers</li>
                                <li>Check if device is already in Intune</li>
                                <li>Register device in Intune if needed</li>
                            </ul>
                            <button class="start-btn feature-btn" data-goto="intune">Register New Device</button>
                        </div>
                        <div class="step">
                            <h3>Resource Account Management</h3>
                            <p>Check if Microsoft Teams room accounts exist.</p>
                            <ul class="feature-list">
                                <li>Validate resource account existence</li>
                                <li>Check both primary domain and onmicrosoft.com domain</li>
                                <li>Get account domain information</li>
                            </ul>
                            <button class="start-btn feature-btn" data-goto="account">Check Resource Account</button>
                        </div>
                    </div>
                    
                    <div class="limitations-section">
                        <h3>Current Limitations</h3>
                        <ul class="limitations-list">
                            <li>Cannot create new resource accounts</li>
                            <li>Cannot provision in Teams Admin Center or generate daily codes for devices</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Intune Provisioning Tab -->
            <div class="tab-content" id="intune">
                <div class="form-section centered-section">
                    <h2>Register Logitech MTR Device in Intune</h2>
                    <div class="form-group">
                        <div class="requirements-note">
                            <span class="requirement-icon">ℹ️</span>
                            <span class="requirement-text">This tab allows you to register Logitech MTR devices in Microsoft Intune. Enter the device serial number (must be exactly 12 characters and end with '2'), then click Check to verify if it's already registered.</span>
                        </div>
                        <label for="serialNumber">Input Serial Number:</label>
                        <div class="input-with-button">
                            <input type="text" id="serialNumber" required placeholder="e.g., 123456789012">
                            <button type="button" id="checkSerialBtn" class="check-btn" disabled>Check</button>
                        </div>
                        <div class="validation-message" id="serialValidation"></div>
                    </div>
                </div>

                <div id="deviceSetupSection" class="form-section centered-section hidden">
                    <h2>Provision New Device</h2>
                    <div class="form-group">
                        <label for="provisionSerialNumber">Serial Number:</label>
                        <input type="text" id="provisionSerialNumber" readonly>
                    </div>
                    <div class="form-group">
                        <label for="description">Device Description:</label>
                        <input type="text" id="description" required placeholder="Enter a description for this device">
                        <small>Example: Logitech Rallybar B260 S33</small>
                    </div>
                    <button type="button" id="provisionIntuneBtn" class="provision-btn">Register in Intune</button>
                    <div id="permanentSuccessMessage" class="permanent-success-message hidden"></div>
                    <button id="resetBtn" class="reset-btn">Setup Another Device</button>
                </div>
            </div>

            <!-- Resource Account Tab -->
            <div class="tab-content" id="account">
                <div class="resource-account-content">
                    <form id="setupForm" class="setup-form">
                        <div class="form-section">
                            <h2>Check Resource Account</h2>
                            <div class="form-group">
                                <div class="requirements-note">
                                    <span class="requirement-icon">ℹ️</span>
                                    <span class="requirement-text">Enter the UPN (User Principal Name) to check if the resource account exists. The system will check both the original domain (e.g., room@testeuc.no) and the onmicrosoft.com domain (e.g., room@testeuc.onmicrosoft.com).</span>
                                </div>
                                <label for="upn">User Principal Name (UPN):</label>
                                <div class="input-with-button">
                                    <input type="email" id="upn" required placeholder="e.g., room01@banenor.no">
                                    <button type="button" id="checkUpnBtn" class="check-btn" disabled>Check</button>
                                </div>
                                <small>Example: room01@banenor.no</small>
                                <div class="validation-message" id="upnValidation"></div>
                            </div>
                            
                            <div id="accountUpdateSection" class="account-update-section hidden">
                                <div class="form-group">
                                    <label for="updateDisplayName">Display Name:</label>
                                    <div class="input-with-button">
                                        <input type="text" id="updateDisplayName" required placeholder="Current display name">
                                        <button type="button" id="updateAccountBtn" class="check-btn">Update</button>
                                    </div>
                                    <small>Current display name will be shown here</small>
                                </div>
                                <div id="updateSuccessMessage" class="permanent-success-message hidden"></div>
                            </div>
                            
                            <!-- Account Status Section -->
                            <div id="accountPasswordSection" class="account-section hidden">
                                <h3>Account Status</h3>
                                <div class="status-indicator">
                                    <div id="passwordStatusIndicator" class="indicator"></div>
                                    <span id="passwordStatusText">Not verified</span>
                                    <button id="resetPasswordBtn" class="action-btn">Reset to Generic Password</button>
                                </div>
                                <div id="passwordSuccessMessage" class="action-success-message hidden"></div>
                                
                                <!-- Account status items -->
                                <div class="status-item">
                                    <div class="status-indicator">
                                        <div id="accountLockedIndicator" class="indicator"></div>
                                        <span>Account Unlocked</span>
                                    </div>
                                </div>
                                <div class="status-item license-item">
                                    <div class="license-status">
                                        <div id="resourceGroupIndicator" class="indicator"></div>
                                        <span>MTR-Resource Accounts - Group Membership</span>
                                    </div>
                                    <div class="license-actions">
                                        <button id="addToMtrStatusBtn" class="small-action-btn">Add</button>
                                        <button id="removeFromMtrStatusBtn" class="small-action-btn">Remove</button>
                                    </div>
                                </div>
                                <div class="license-note">Required for all meeting rooms. This group is mandatory for any Teams room account.</div>
                            </div>
                            
                            <!-- License Management Section -->
                            <div id="licensesSection" class="account-section hidden">
                                <h3>License Group Memberships</h3>
                                <p>Group memberships determine what Microsoft Teams licenses and features are available to this account.</p>
                                
                                <div class="license-item">
                                    <div class="license-status">
                                        <div id="roomGroupIndicator" class="indicator"></div>
                                        <span>MTR-Teams-Panel-License-Microsoft Teams Shared Devices</span>
                                    </div>
                                    <div class="license-actions">
                                        <button id="addToRoomBtn" class="small-action-btn">Add</button>
                                        <button id="removeFromRoomBtn" class="small-action-btn">Remove</button>
                                    </div>
                                </div>
                                <div class="license-note">Required for Teams Shared Devices license. Required for all rooms without Rallybar.</div>
                                
                                <div class="license-item">
                                    <div class="license-status">
                                        <div id="proGroupIndicator" class="indicator"></div>
                                        <span>MTR-Teams-Room-License-Teams Rooms Pro</span>
                                    </div>
                                    <div class="license-actions">
                                        <button id="addToProBtn" class="small-action-btn">Add</button>
                                        <button id="removeFromProBtn" class="small-action-btn">Remove</button>
                                    </div>
                                </div>
                                <div class="license-note">Required for Teams Rooms Pro license. Required for all rooms with Rallybar.</div>
                                
                                <div id="licenseSuccessMessage" class="action-success-message hidden"></div>
                            </div>
                            
                            <button id="resetAccountBtn" class="reset-btn">Check Another Account</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="results" class="results hidden">
                <h2>Setup Results</h2>
                <div class="result-section">
                    <h3>Device Status</h3>
                    <pre id="deviceStatus"></pre>
                </div>
                <div class="result-section">
                    <h3>User Account Status</h3>
                    <pre id="userStatus"></pre>
                </div>
                <div class="result-section">
                    <h3>Group Memberships</h3>
                    <pre id="groupStatus"></pre>
                </div>
                <button id="resetBtn" class="reset-btn">Setup Another Device</button>
            </div>
        </main>

        <div id="loader" class="loader hidden">
            <div class="spinner"></div>
            <p id="loaderText">Checking device...</p>
        </div>

        <div id="toast" class="toast hidden">
            <span id="toastMessage"></span>
        </div>
        
        <footer class="app-footer static-footer">
            <div class="footer-content">
                <p>Created by Sopra Steria | Creator: Olav Heggelund | March 2025</p>
                <p class="license">© 2025 Bane NOR. All rights reserved.</p>
            </div>
        </footer>
    </div>
    <script type="module" src="index.js"></script>
</body>
</html> 